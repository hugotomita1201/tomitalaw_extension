# PRD: Japanese Address Formatting Update (v5.6)

## Objective
Update DS-160 prompt v5.5 to correctly format Japanese addresses according to U.S. Consulate standards, ensuring proper handling of administrative suffixes and building names.

---

## Background

**Current Problem:**
- v5.5 removes ALL Japanese administrative suffixes (-shi, -ku, -cho, -gun)
- This violates U.S. Consulate formatting standards
- Example output is incorrect

**Correct Standard (U.S. Consulate):**
- Keep ward/district identifiers: -ku, -cho/-machi, -gun
- Remove ONLY city suffix: -shi (e.g., "Osaka-shi" → "Osaka")
- Remove ONLY prefecture suffix: -ken/-fu (e.g., "Osaka-fu" → "Osaka")
- Building names → separate apartment field

---

## Requirements

### Requirement 1: Update Section 6 Rules (Lines 90-103)

**Current Text:**
```markdown
6. **Japanese Address Suffixes (English/Romaji)**:
   - DS-160 uses English/romaji for all non-US addresses
   - Remove administrative suffixes (form fields already labeled):
   - **City field** - Remove city-level suffixes:
     - "-shi" → "Osaka-shi" becomes "Osaka"
     - "-ku" → "Shibuya-ku" becomes "Shibuya"
     - "-cho" or "-machi" → "Fuchu-cho" becomes "Fuchu"
     - "-mura", "-gun" → remove
   - **State field** - Remove prefecture-level suffixes:
     - "-to" → "Tokyo-to" becomes "Tokyo"
     - "-fu" → "Osaka-fu" becomes "Osaka"
     - "-ken" → "Kanagawa-ken" becomes "Kanagawa"
     - "Hokkaido" stays "Hokkaido"
   - **Complete example**: Source "パークタワー 502号室, 3-14-7 渋谷, 渋谷区, 東京都" → homeStreet: "3-14-7 SHIBUYA PARK TOWER", homeApt: "APT.502", homeCity: "Shibuya", homeState: "Tokyo"
```

**New Text:**
```markdown
6. **Japanese Address Formatting (English/Romaji)**:
   - DS-160 uses English/romaji for all non-US addresses
   - Street number MUST come first (e.g., "2-11-5 Nishitenma")
   - Include hyphens in postal codes (e.g., "530-8543")

   **Administrative Suffixes:**
   - **Remove from City/State fields ONLY:**
     - City: Remove "-shi" (e.g., "Osaka-shi" → "Osaka")
     - Prefecture: Remove "-ken/-fu/-to" (e.g., "Osaka-fu" → "Osaka", "Tokyo-to" → "Tokyo")
     - Exception: "Hokkaido" stays "Hokkaido" (no suffix)

   - **KEEP in Street Address:**
     - Ward: "-ku" (e.g., "Kita-ku")
     - Town: "-cho" or "-machi" (e.g., "Nishitenma")
     - County: "-gun" (e.g., "Seta-gun")

   **Building/Apartment Handling:**
   - Building name → Move to apartment field (APT. format)
   - Do NOT include building name in street address

   **Format Structure:**
   - homeStreet: "[number-number-number] [street name], [ward/district]"
   - homeApt: "APT.[room number]" (if building has unit number)
   - homeCity: "[city name without -shi]"
   - homeState: "[prefecture without -ken/-fu/-to]"
   - homePostalCode: "[xxx-xxxx with hyphen]"
```

**Acceptance Criteria:**
- [ ] Clearly states what to REMOVE (only -shi from city, -ken/-fu/-to from prefecture)
- [ ] Clearly states what to KEEP (-ku, -cho, -gun in street address)
- [ ] Building name handling explained
- [ ] Format structure clearly defined

---

### Requirement 2: Add Two Concrete Examples (After Rules)

**Example 1:**
```markdown
**Example 1:**
Source: 〒530-8543 Osaka-fu, Osaka-shi, Kita-ku, Nishitenma 2-11-5 U.S. General Consulate Building

Output:
- homeStreet: "2-11-5 NISHITENMA, KITA-KU"
- homeApt: (omit - consulate building, not residential apartment)
- homeCity: "OSAKA"
- homeState: "OSAKA"
- homePostalCode: "530-8543"
- homeCountry: "JPN"
```

**Example 2:**
```markdown
**Example 2:**
Source: 〒064-0821 Hokkaido, Sapporo-shi, Chuo-ku, Kita 1-jo Nishi 28-chome

Output:
- homeStreet: "KITA 1-JO NISHI 28-CHOME, CHUO-KU"
- homeApt: (omit if no unit number)
- homeCity: "SAPPORO"
- homeState: "HOKKAIDO"
- homePostalCode: "064-0821"
- homeCountry: "JPN"
```

**Acceptance Criteria:**
- [ ] Example 1 shows Osaka double-name handling (Osaka-fu, Osaka-shi)
- [ ] Example 2 shows Hokkaido (no prefecture suffix)
- [ ] Both examples show -ku KEPT in street address
- [ ] Both examples show building names handled correctly
- [ ] Field-by-field breakdown for clarity

---

### Requirement 3: Update Complete JSON Example (Lines 856-862)

**Current (WRONG):**
```json
"contact": {
  "homeStreet": "2-15-8 Roppongi Mansion Hills",
  "homeApt": "APT.1205",
  "homeCity": "Minato",
  "homeState": "Tokyo",
  "homePostalCode": "106-0032",
  "homeCountry": "JPN",
```

**New (CORRECT):**
```json
"contact": {
  "homeStreet": "2-15-8 ROPPONGI, MINATO-KU",
  "homeApt": "APT.1205",
  "homeCity": "TOKYO",
  "homeState": "TOKYO",
  "homePostalCode": "106-0032",
  "homeCountry": "JPN",
```

**Rationale:**
- Original address: "2-15-8 Roppongi, Minato-ku, Tokyo-to 106-0032"
- Street: "2-15-8 ROPPONGI, MINATO-KU" (keep -ku)
- Building "Mansion Hills" moved to apartment field: "APT.1205"
- City: "TOKYO" (Minato-ku is ward, Tokyo is city)
- State: "TOKYO" (remove -to from Tokyo-to)

**Acceptance Criteria:**
- [ ] Street address includes ward (-ku)
- [ ] Building name NOT in street field
- [ ] City is "TOKYO" not "Minato"
- [ ] Postal code has hyphen

---

### Requirement 4: Update mailingAddress Example (Lines 864-871)

**Current (WRONG):**
```json
"mailingAddress": {
  "street": "1-3-5 Marunouchi Tokyo Station Building",
  "apt": "FL.20",
  "city": "Chiyoda",
  "state": "Tokyo",
```

**New (CORRECT):**
```json
"mailingAddress": {
  "street": "1-3-5 MARUNOUCHI, CHIYODA-KU",
  "apt": "FL.20",
  "city": "TOKYO",
  "state": "TOKYO",
```

**Rationale:**
- Original: "1-3-5 Marunouchi, Chiyoda-ku, Tokyo-to"
- Street: Include Chiyoda-ku (ward)
- Building "Tokyo Station Building" → separate floor field
- City: Tokyo (Chiyoda-ku is ward within Tokyo city)

**Acceptance Criteria:**
- [ ] Ward (-ku) included in street
- [ ] Building name removed from street
- [ ] City is "TOKYO" not "Chiyoda"

---

### Requirement 5: Update presentEmployer Address Example (Lines 972-980)

**Current (WRONG):**
```json
"presentEmployer": {
  "name": "NAKAMURA TRADING CO LTD",
  "address": {
    "street1": "1-3-5 Marunouchi Tokyo Station Building",
    "street2": "FL.20",
    "city": "Chiyoda",
    "state": "Tokyo",
```

**New (CORRECT):**
```json
"presentEmployer": {
  "name": "NAKAMURA TRADING CO LTD",
  "address": {
    "street1": "1-3-5 MARUNOUCHI, CHIYODA-KU",
    "street2": "FL.20",
    "city": "TOKYO",
    "state": "TOKYO",
```

**Acceptance Criteria:**
- [ ] Same fix as mailing address
- [ ] Consistent with contact address format

---

### Requirement 6: Update previousEmployers Address Example (Lines 989-998)

**Current (WRONG):**
```json
"previousEmployers": [
  {
    "name": "MITSUBISHI CORPORATION",
    "address": {
      "street1": "3-1-1 Marunouchi Mitsubishi Building",
      "city": "Chiyoda",
      "state": "Tokyo",
```

**New (CORRECT):**
```json
"previousEmployers": [
  {
    "name": "MITSUBISHI CORPORATION",
    "address": {
      "street1": "3-1-1 MARUNOUCHI, CHIYODA-KU",
      "street2": "",
      "city": "TOKYO",
      "state": "TOKYO",
```

**Acceptance Criteria:**
- [ ] Building name removed
- [ ] Ward included in street
- [ ] City is Tokyo

---

### Requirement 7: Update education Address Example (Lines 1010-1018)

**Current (WRONG):**
```json
"institutions": [
  {
    "name": "UNIVERSITY OF TOKYO",
    "address": {
      "street1": "7-3-1 Hongo",
      "city": "Bunkyo",
      "state": "Tokyo",
```

**New (CORRECT):**
```json
"institutions": [
  {
    "name": "UNIVERSITY OF TOKYO",
    "address": {
      "street1": "7-3-1 HONGO, BUNKYO-KU",
      "city": "TOKYO",
      "state": "TOKYO",
```

**Acceptance Criteria:**
- [ ] Ward included
- [ ] City corrected to Tokyo

---

### Requirement 8: Update payerInfo Address Example (Lines 786-791)

**Current (WRONG):**
```json
"payerInfo": {
  ...
  "street1": "3-15-2 Shibuya Yamada Building",
  "street2": "FL.8",
  "city": "Shibuya",
  "state": "Tokyo",
```

**New (CORRECT):**
```json
"payerInfo": {
  ...
  "street1": "3-15-2 SHIBUYA, SHIBUYA-KU",
  "street2": "FL.8",
  "city": "TOKYO",
  "state": "TOKYO",
```

**Acceptance Criteria:**
- [ ] Ward included
- [ ] Building name removed
- [ ] City is Tokyo

---

## Implementation Steps

1. **Create v5.6 file** - Copy ds160_prompt_combined_v5.5.txt → v5.6.txt
2. **Update Section 6** (Requirement 1) - Rewrite rules
3. **Add Examples** (Requirement 2) - Insert after Section 6
4. **Update JSON Examples** (Requirements 3-8) - Fix all 6 address examples
5. **Update DS160_FORMATTING_STANDARDS.md** - Document v1.6 changelog
6. **Test** - Verify with ChatGPT using sample Japanese addresses

---

## Success Metrics

- [ ] All 6 JSON examples have correct Japanese address format
- [ ] Section 6 rules clearly distinguish what to keep vs. remove
- [ ] Two concrete examples show correct transformation
- [ ] Documentation updated in DS160_FORMATTING_STANDARDS.md

---

## Notes

**Key Changes:**
- Ward (-ku) now KEPT in street address, not removed
- City field gets actual city name (Tokyo, Osaka, Sapporo), not ward name
- Building names extracted to apartment field
- Examples corrected to reflect proper hierarchy: ward within city within prefecture

**Affected Files:**
- `/Users/hugo/tomitalaw_extension/prompts_and_templates/form_prompts/ds160_prompt_combined_v5.5.txt` → create v5.6
- `/Users/hugo/tomitalaw_extension/prompts_and_templates/form_prompts/DS160_FORMATTING_STANDARDS.md` → add v1.6 changelog
